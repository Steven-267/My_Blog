---
icon: pen-to-square
date: 2025-4-18
category:
- 后端
tag:
- 实习
---
# 总结
# 1.定义对应的枚举找到数据库中的url拿到对应的mack数据

```
String resBody = HttpUtils.httpEsbSend(UrlConfigEnum.DEFAULT_NEW_PENSION_OVERVIEW.getUrlId(),
        HttpRealPostInfo.builder().body(getBody(ZERO, custNo)).header(getHeader(ZERO)).build());
```

```
select * from WP_RESTFUL_ESB_INFO where id LIKE 'DE%';
```

![image-20250403132812018](/Users/xiaoxu/Library/Application Support/typora-user-images/image-20250403132812018.png)

# 2.Dto和Res分层

------

## ✅ 解耦分层，职责分明**

| 层级       | 对象                          | 作用                                 |
| ---------- | ----------------------------- | ------------------------------------ |
| Service 层 | `DTO`（Data Transfer Object） | 内部业务传输，可能包含敏感或中间字段 |
| API 层     | `Res`（Response View Object） | 对外展示，仅返回前端需要的数据字段   |

------

## ✅ 为什么不能直接返回 DTO？

### 🟥 风险 1：接口变更被“内部字段”牵连

Service 层 DTO 可能包含一些中间字段，比如：

```java
private BigDecimal internalFee;
private String internalRiskLevel;
```

这些字段可能是用于后续计算或风控的，**前端/用户根本不该看到**。

------

### 🟥 风险 2：DTO 改了，前端接口就“崩了”

比如你 DTO 新增了字段用于内部计算，结果 API 直接返回，前端突然收到一个不认识的字段，页面可能异常报错。

------

# 3.返回数据处理

```java
if (StrUtil.isBlank(responseJson)) {
```

👉 判断远程返回是否为空字符串，避免后续 JSON 解析崩溃。

------

```java
root = JSONUtil.parseObj(responseJson);
```

👉 把 JSON 字符串解析为 `JSONObject` 对象（使用 Hutool 工具），便于后续读取字段。

------

```java
String status = root.getStr("status");
```

👉 读取 JSON 中的 `"status"` 字段，通常用于判断接口是否成功（"0000"）。

------

```java
root.getStr("statusMsg");
```

👉 获取错误描述信息字段，用于日志输出或提示。

------

```java
JSONObject dataJson = root.getJSONObject("data");
```

👉 读取接口返回结果里的 `"data"` 部分内容（真正的数据体）。

------

```java
JSONUtil.toBean(dataJson, PensionAssetOverviewDto.class);
```

👉 核心：**将 `dataJson` 映射为你定义的 Java 类 `PensionAssetOverviewDto`**。字段名需要匹配，嵌套结构也会自动映射。



> 远程接口调用后 → 判空 → 解析 JSON → 状态判断 → 提取 data → 映射成业务对象”的流程。

# 4.记录http远程调用耗时

```
long start = System.currentTimeMillis();
log.info("[PensionServiceImpl-getPensionAssetOverview] 调用远程开始时间：{}", start);

String responseJson;
try {
    responseJson = PensionRealPostUtils.getPensionAssetOverview(qry.getCustNo());
} catch (Exception e) {
    log.error("养老金资产总览远程调用异常，custNo={}, 异常={}", qry.getCustNo(), e.getMessage(), e);
    return null;
}

long end = System.currentTimeMillis();
log.info("[PensionServiceImpl-getPensionAssetOverview] 调用远程结束时间：{}，耗时={}ms", end, (end - start));
```