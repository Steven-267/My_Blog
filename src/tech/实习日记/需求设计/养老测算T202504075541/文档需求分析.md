---
icon: pen-to-square
date: 2025-4-18
category:
- 后端
tag:
- 实习
---
# 文档需求分析

# 1.理解大致业务（养老测算详细设计文档）

**✅ 总体业务功能模块图**

```
养老测算系统
├── 1. 一支柱养老金测算（基本养老）
├── 2. 二支柱养老金测算（企业/职业年金）
├── 3. 三支柱养老金测算（个人账户 + 备老账户 + 外部储备）
├── 4. 缺口分析（当前 vs 目标）
├── 5. 月工资比例测算（计算推荐比例X%）
├── 6. 固定金额测算（计算推荐月投入）
├── 7. 接口封装
│   ├── /getGapInsight（缺口分析）
│   └── /getPlanRecommendation（月工资比例 + 固定金额测算）
```

**✅ 核心公式/概念一览（基础理解）**

| **名称** | **含义**                     |
| -------- | ---------------------------- |
| FV       | 未来值（终值）               |
| PV       | 当前值（现值）               |
| PMT      | 每期投入/提取金额            |
| I        | 利率（通常为年利率、月利率） |
| N        | 期数（通常为月数或年数）     |

**✅ 六大计算流程总览**



**📌 一支柱：基本养老金（月）**

​	•	每月养老金 = 基础养老金 + 个人账户养老金 + 过渡性养老金（默认0）

​	•	基础养老金：取决于平均缴费指数、缴费年限、退休时平均工资

​	•	个人账户养老金：需逐年累加储蓄额（FV 计算）



------



**📌 二支柱：企业/职业年金（月）**

​	•	每月养老金 = 累计总额 / 养老金发放月数 × (1 - 税率)

​	•	累计总额 = FV(年金月利率, 剩余月数, 每月投入, 当前余额, 1)



------



**📌 三支柱：个人储备（月）**



组成：

​	•	个人养老金账户（3%收益率）

​	•	备老金账户（5%）

​	•	外部养老金账户（5%）



计算逻辑：

​	•	每年/每月滚动 FV 叠加存储 + 投资复利

​	•	每月领取金额 = -PMT(月利率, 月数, 总余额, 0, 1)



------



**📌 缺口分析：**

​	•	总养老金 = 一 + 二 + 三支柱

​	•	目标金额 = 当前月支出 × 替代率 × 通胀FV系数

​	•	缺口 = 目标 - 实际



------



**📌 月工资比例投入法：**

​	•	假设A/B工资每月增长至高峰后递减

​	•	每月投入 = 工资 × X% × 投资复利

​	•	累加总值 >= 缺口，求最小X%



------



**📌 固定金额投入法：**

​	•	使用 PMT() 计算每月应投入固定金额，使未来总值刚好覆盖缺口





# 2.查看需求页面原型

![image-20250412002530660](/Users/xiaoxu/Library/Application Support/typora-user-images/image-20250412002530660.png)

# 3.分析具体任务

**💼 月工资比例测算逻辑**

**🧭 目标说明**



根据当前本人和（可选）配偶的工资、退休时间、工资增长/下降趋势、理财年化收益率，测算出一个最小的月工资投入比例 X%，使得两人退休时养老金储备金额 ≥ 总养老缺口（由缺口分析模块提供）。

------



**1️⃣ 功能入口（接口请求）**



接口路径：

```
POST /iae/wealth/scene/pensionPlan/getPlanRecommendation
```

请求参数（简化）：

```
{
  "custNo": "A172128113813600001"
}
```





------



**2️⃣ 核心需求目标**



> 找出最小整数 X（1~100），使得：

```
SumA（本人投入总未来值） + SumB（配偶投入总未来值） ≥ 总养老缺口
```





​	•	SumA/B 是在退休时，所有投入金额（每月工资 × X%）经月复利后的合计

​	•	X% 是你要计算出来的“推荐月工资投入比例”

​	•	如果开关选择**不考虑配偶**，则 SumB = 0



------



**3️⃣ 输入参数详解（后端依赖项）**

| 字段                          | 含义                                                  |
| ----------------------------- | ----------------------------------------------------- |
| `custNo`                      | 用户唯一标识                                          |
| `缺口金额 gapAmount`          | 来自 `/getGapInsight` 的输出                          |
| `当前年月 currentDate`        | 例如 2025年3月                                        |
| `本人出生年月 birthDateA`     | 例如 1980-08                                          |
| `本人退休年龄 retireAgeA`     | 例如 65                                               |
| `本人当前月薪 salaryA`        | 例如 20000                                            |
| `本人工资增长率 growRateA`    | 例如 10%                                              |
| `本人工资下降率 dropRateA`    | 例如 1%                                               |
| `本人工资峰值年龄 peakAgeA`   | 例如 45                                               |
| `配偶是否启用 includeSpouse`  | 由开关控制，true / false                              |
| `配偶出生年月 birthDateB`     | 例如 1983-08                                          |
| `配偶退休年龄 retireAgeB`     | 例如 60                                               |
| `配偶当前月薪 salaryB`        | 例如 15000                                            |
| `配偶工资增长率 growRateB`    | 例如 10%                                              |
| `配偶工资下降率 dropRateB`    | 例如 1%                                               |
| `配偶工资峰值年龄 peakAgeB`   | 例如 45                                               |
| `退休前年化收益率 investRate` | 默认4%，计算得月利率 `monthRate = (1 + r)^(1/12) - 1` |

------



**4️⃣ 流程总览图**

```
Start
  ↓
取用户 & 配偶信息、缺口数据
  ↓
计算A/B退休前剩余月数（投资期）
  ↓
构造工资时间线（每月工资表）
  ↓
for x = 1 to 100:
    sumA = 计算本人投入总未来值(x)
    sumB = 配偶开关打开？计算配偶投入总未来值(x) ： 0
    if sumA + sumB ≥ 缺口:
        break
  ↓
输出推荐X + 每年投入明细
  ↓
缓存结果（客户号+是否包含配偶）
  ↓
返回响应数据
```





------



**5️⃣ 每一步详细实现说明**



------



**🧩 第一步：计算投资月数**



公式：

```
投资月数 = (出生年 + 退休年龄 - 1 - 当前年) * 12 + 出生月 + (12 - 当前月 + 1)
```

解释：

​	•	当前月算一个完整月，无需判断是否超过15号

​	•	示例（A）：出生1980年8月，退休65岁，当前2025年3月 ⇒

```
(1980 + 64 - 2025) * 12 + 8 + (12 - 3 + 1) = 222个月
```





------



**🧩 第二步：构造工资表（逐月工资）**



工资变化分为两阶段：



**🎯 阶段1：工资增长（峰值前）**

​	•	每年工资 = 上一年工资 × (1 + 增长率)

​	•	每月工资 = 年初工资 / 12（保持一致）



**🎯 阶段2：工资下降（峰值后）**

​	•	每年工资 = 上一年工资 × (1 - 下降率)

​	•	同样，全年每月工资不变



> 工资曲线：不断增长 → 峰值 → 递减，持续到退休月份



------



**🧩 第三步：计算未来值FV（带复利）**



对每一个月：

```
n = 当前月距退休还有几个月
投入金额 = 当前工资 × (X / 100)
未来值FV = 投入金额 × (1 + 月利率)^n
```

月利率计算方式：

```
monthRate = (1 + investRate) ^ (1 / 12) - 1
```





------



**🧩 第四步：遍历X，从1到100寻找最小满足条件值**



伪代码：

```
for (int x = 1; x <= 100; x++) {
    BigDecimal sumA = calcFutureValueForUser(x);
    BigDecimal sumB = includeSpouse ? calcFutureValueForSpouse(x) : BigDecimal.ZERO;
    if (sumA.add(sumB).compareTo(gapAmount) >= 0) {
        break;
    }
}
```





------



**🧩 第五步：生成年度投入明细表格（前端展示）**

​	•	将月工资投入金额按年汇总

​	•	每一项包括：

```
{
  "year": 2026,
  "age": 46,
  "personalContribution": 12400.00,
  "spouseContribution": 9800.00,
  "totalContribution": 22200.00,
  "isPersonalRetired": 0,
  "isSpouseRetired": 0
}
```

​	•	退休年判断规则：

​	•	当前年 > 出生年 + 退休年龄 ⇒ 已退休

------



